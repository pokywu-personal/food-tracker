<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Macro & Calorie Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f3f4f6; }
        .card { transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); }
    </style>
</head>
<body class="text-gray-800">

    <nav class="bg-indigo-600 text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold"><i class="fas fa-utensils mr-2"></i>MacroMaster AI</h1>
            <div id="user-stats" class="text-sm font-light">Target: Not Set</div>
        </div>
    </nav>

    <div class="container mx-auto p-4 max-w-4xl">
        
        <div class="bg-white p-6 rounded-lg shadow-md mb-6" id="setup-panel">
            <h2 class="text-lg font-bold mb-4 text-indigo-700">1. Setup Your Goals (TDEE)</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="number" id="weight" placeholder="Weight (kg)" class="border p-2 rounded">
                <input type="number" id="height" placeholder="Height (cm)" class="border p-2 rounded">
                <input type="number" id="age" placeholder="Age" class="border p-2 rounded">
                <select id="gender" class="border p-2 rounded">
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                </select>
                <select id="activity" class="border p-2 rounded">
                    <option value="1.2">Sedentary</option>
                    <option value="1.375">Lightly Active</option>
                    <option value="1.55">Moderately Active</option>
                    <option value="1.725">Very Active</option>
                </select>
                <select id="goal" class="border p-2 rounded">
                    <option value="0">Maintain Weight</option>
                    <option value="-500">Cut (-500 cal)</option>
                    <option value="300">Bulk (+300 cal)</option>
                </select>
            </div>
            <button onclick="calculateTDEE()" class="mt-4 bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-700 w-full font-bold">Set Targets</button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 hidden" id="dashboard">
            <div class="bg-white p-4 rounded-lg shadow border-l-4 border-blue-500 card">
                <p class="text-gray-500 text-sm">Calories</p>
                <div class="flex justify-between items-end">
                    <span class="text-2xl font-bold" id="cal-curr">0</span>
                    <span class="text-sm text-gray-400" id="cal-target">/ 2000</span>
                </div>
                <div class="w-full bg-gray-200 h-2 mt-2 rounded-full">
                    <div id="cal-bar" class="bg-blue-500 h-2 rounded-full" style="width: 0%"></div>
                </div>
            </div>

             <div class="bg-white p-4 rounded-lg shadow border-l-4 border-green-500 card">
                <p class="text-gray-500 text-sm">Protein</p>
                <div class="flex justify-between items-end">
                    <span class="text-2xl font-bold" id="pro-curr">0g</span>
                    <span class="text-sm text-gray-400" id="pro-target">/ 150g</span>
                </div>
                <div class="w-full bg-gray-200 h-2 mt-2 rounded-full">
                    <div id="pro-bar" class="bg-green-500 h-2 rounded-full" style="width: 0%"></div>
                </div>
            </div>

            <div class="bg-white p-4 rounded-lg shadow border-l-4 border-yellow-500 card">
                <p class="text-gray-500 text-sm">Remaining</p>
                <p class="text-xs mt-2">Carbs: <span id="carb-curr">0</span>g</p>
                <p class="text-xs">Fats: <span id="fat-curr">0</span>g</p>
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-md mb-6 hidden" id="logging-panel">
            <h2 class="text-lg font-bold mb-4 text-indigo-700">2. Add Food</h2>
            
            <div class="flex mb-4 border-b">
                <button onclick="switchTab('manual')" class="px-4 py-2 border-b-2 border-indigo-600 text-indigo-600 font-bold" id="btn-manual">Manual Input</button>
                <button onclick="switchTab('ai')" class="px-4 py-2 text-gray-500 hover:text-indigo-600" id="btn-ai">AI Camera</button>
            </div>

            <div id="manual-form">
                <div class="grid grid-cols-1 md:grid-cols-5 gap-2 mb-2">
                    <input type="text" id="food-name" placeholder="Food Name (e.g. Chicken)" class="border p-2 rounded md:col-span-2">
                    <input type="number" id="food-cal" placeholder="Cals" class="border p-2 rounded">
                    <input type="number" id="food-pro" placeholder="Prot(g)" class="border p-2 rounded">
                    <input type="date" id="food-date" class="border p-2 rounded">
                </div>
                <button onclick="addFood()" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 w-full"><i class="fas fa-plus"></i> Add to Log</button>
            </div>

            <div id="ai-form" class="hidden text-center py-6">
                <div class="border-2 border-dashed border-gray-300 p-6 rounded-lg mb-4">
                    <i class="fas fa-camera text-4xl text-gray-400 mb-2"></i>
                    <p>Upload a photo of your meal</p>
                </div>
                <button onclick="simulateAI()" class="bg-purple-600 text-white px-6 py-2 rounded hover:bg-purple-700">
                    <i class="fas fa-magic"></i> Analyze Image (Simulated)
                </button>
                <p id="ai-status" class="text-sm text-gray-500 mt-2"></p>
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-md hidden" id="history-panel">
            <h3 class="font-bold text-gray-700 mb-2">Today's Log</h3>
            <ul id="food-list" class="divide-y divide-gray-200">
                </ul>
        </div>

    </div>

    <script>
        // --- STATE MANAGEMENT ---
        let userTargets = { cals: 2000, protein: 150 };
        let currentTotals = { cals: 0, protein: 0, carbs: 0, fat: 0 };
        
        // Set default date to today
        document.getElementById('food-date').valueAsDate = new Date();

        // --- FUNCTIONS ---

        function calculateTDEE() {
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            const age = parseFloat(document.getElementById('age').value);
            const gender = document.getElementById('gender').value;
            const activity = parseFloat(document.getElementById('activity').value);
            const goal = parseFloat(document.getElementById('goal').value);

            if (!weight || !height || !age) {
                alert("Please fill in all fields");
                return;
            }

            // Mifflin-St Jeor Equation
            let bmr = (10 * weight) + (6.25 * height) - (5 * age);
            bmr += (gender === 'male') ? 5 : -161;

            const tdee = Math.round(bmr * activity);
            const targetCals = tdee + goal;
            
            // Simple split: Protein is approx 2g per kg of bodyweight
            const targetProtein = Math.round(weight * 2);

            userTargets = { cals: targetCals, protein: targetProtein };
            
            // Update UI
            document.getElementById('user-stats').innerText = `Target: ${targetCals} kcal / ${targetProtein}g Protein`;
            document.getElementById('cal-target').innerText = `/ ${targetCals}`;
            document.getElementById('pro-target').innerText = `/ ${targetProtein}g`;
            
            // Reveal Dashboard
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('logging-panel').classList.remove('hidden');
            document.getElementById('history-panel').classList.remove('hidden');
            document.getElementById('setup-panel').classList.add('hidden'); // Hide setup to save space
            
            updateBars();
        }

        function addFood(name, cals, pro, dateOverride) {
            // Get values from inputs if not provided as arguments
            const fName = name || document.getElementById('food-name').value;
            const fCals = parseInt(cals || document.getElementById('food-cal').value);
            const fPro = parseInt(pro || document.getElementById('food-pro').value);
            const fDate = dateOverride || document.getElementById('food-date').value;

            if (!fName || isNaN(fCals)) {
                alert("Please enter a name and calorie amount.");
                return;
            }

            // Update Totals
            currentTotals.cals += fCals;
            currentTotals.protein += (isNaN(fPro) ? 0 : fPro);
            currentTotals.carbs += 0; // Simplified for demo
            currentTotals.fat += 0; // Simplified for demo

            // Add to UI List
            const list = document.getElementById('food-list');
            const li = document.createElement('li');
            li.className = "py-3 flex justify-between items-center";
            li.innerHTML = `
                <div>
                    <span class="font-medium">${fName}</span>
                    <span class="text-xs text-gray-500 block">${fDate}</span>
                </div>
                <div class="text-right">
                    <span class="font-bold text-indigo-600">${fCals} cal</span>
                    <span class="text-xs text-gray-500 block">${fPro}g Pro</span>
                </div>
            `;
            list.prepend(li); // Add to top

            // Clear inputs
            document.getElementById('food-name').value = "";
            document.getElementById('food-cal').value = "";
            document.getElementById('food-pro').value = "";

            updateBars();
        }

        function updateBars() {
            // Calories
            document.getElementById('cal-curr').innerText = currentTotals.cals;
            const calPct = Math.min((currentTotals.cals / userTargets.cals) * 100, 100);
            document.getElementById('cal-bar').style.width = `${calPct}%`;

            // Protein
            document.getElementById('pro-curr').innerText = `${currentTotals.protein}g`;
            const proPct = Math.min((currentTotals.protein / userTargets.protein) * 100, 100);
            document.getElementById('pro-bar').style.width = `${proPct}%`;
            
            // Others
            document.getElementById('carb-curr').innerText = currentTotals.carbs;
            document.getElementById('fat-curr').innerText = currentTotals.fat;
        }

        function switchTab(tab) {
            if (tab === 'manual') {
                document.getElementById('manual-form').classList.remove('hidden');
                document.getElementById('ai-form').classList.add('hidden');
                document.getElementById('btn-manual').className = "px-4 py-2 border-b-2 border-indigo-600 text-indigo-600 font-bold";
                document.getElementById('btn-ai').className = "px-4 py-2 text-gray-500 hover:text-indigo-600";
            } else {
                document.getElementById('manual-form').classList.add('hidden');
                document.getElementById('ai-form').classList.remove('hidden');
                document.getElementById('btn-ai').className = "px-4 py-2 border-b-2 border-indigo-600 text-indigo-600 font-bold";
                document.getElementById('btn-manual').className = "px-4 py-2 text-gray-500 hover:text-indigo-600";
            }
        }

        function simulateAI() {
            const status = document.getElementById('ai-status');
            status.innerText = "Analyzing image via Neural Network...";
            
            // Simulate API delay
            setTimeout(() => {
                status.innerText = "Food identified: Grilled Salmon & Rice";
                
                // Populate the manual form with 'AI' data
                document.getElementById('food-name').value = "Grilled Salmon & Rice";
                document.getElementById('food-cal').value = 550;
                document.getElementById('food-pro').value = 45;
                
                // Switch back to manual tab so user can review
                setTimeout(() => {
                    switchTab('manual');
                    status.innerText = "";
                    alert("AI Analysis Complete! Please review the data and click 'Add to Log'.");
                }, 1000);
            }, 1500);
        }
    </script>
</body>
</html>